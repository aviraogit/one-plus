(window.webpackJsonp=window.webpackJsonp||[]).push([["product2077/discountModule"],{A7aG:function(e,t,o){},DvI6:function(e,t,o){"use strict";var n=o("mhnD");o.n(n).a},f3R3:function(e,t,o){"use strict";o("hi3g"),o("Xlt+"),o("D/wG");var n=o("OvAC"),i=o.n(n),c={name:"OeCheckbox",props:{value:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},shape:{type:String,default:"square"},colorType:{type:String,default:"black"},outline:{type:Boolean,default:!0},label:{type:String,default:""},isPreventDefault:{type:Boolean,default:!1}},data:function(){return{name:"one-checkbox",parent:{},checkedList:[],isGroup:!1,currentValue:this.value}},computed:{classType:function(){var e;return e={},i()(e,"".concat(this.name,"--").concat(this.currentSize),!0),i()(e,"".concat(this.name,"--").concat(this.currentColor),!0),i()(e,"".concat(this.name,"--").concat(this.currentShape),!0),i()(e,"outline",this.isOutline),i()(e,"disabled",this.isDisabled),e},currentColor:function(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.colorType)||this.colorType},isOutline:function(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.outline)||this.outline},currentSize:function(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.size)||this.size},currentShape:function(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.shape)||this.shape},isDisabled:function(){var e;return(null===(e=this.parent)||void 0===e?void 0:e.disabled)||this.disabled},isChecked:function(){return this.isGroup?this.hasCurrentLabel:this.currentValue},hasCurrentLabel:function(){return this.checkedList.indexOf(this.label)>-1}},watch:{value:{handler:function(e){this.currentValue=e,this.$refs.checkbox.checked=e}}},created:function(){this.findCptUpward("one-checkbox-group")},methods:{clickLabel:function(e){var t=this;this.isDisabled||(this.currentValue=!this.isChecked,this.isPreventDefault&&e.preventDefault(),this.isGroup&&(this.hasCurrentLabel?this.checkedList.splice(this.checkedList.indexOf(this.label),1):this.checkedList.push(this.label)),this.$nextTick((function(){var e,o;t.$emit("input",t.currentValue),t.$emit("change",t.currentValue),null===(e=t.$parent)||void 0===e||e.$emit("change",t.checkedList),null===(o=t.$parent)||void 0===o||o.$emit("input",t.checkedList)})))},findCptUpward:function(e){var t=this.$parent;t&&t.$options&&(t.$options._componentTag===e&&(this.parent=t,this.isGroup=!0,this.checkedList=this.parent.value),t=parent.parent)}}},s=(o("fcH4"),o("psIG")),a=Object(s.a)(c,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"one-checkbox",class:e.classType},[o("input",{ref:"checkbox",attrs:{type:"checkbox",disabled:e.isDisabled,label:e.label},domProps:{checked:e.isChecked},on:{"!click":function(t){return t.stopPropagation(),e.clickLabel(t)}}}),e._v(" "),e._t("default",[e.label?o("label",{staticClass:"one-checkbox--label font-body-md",class:e.classType},[e._v("\n      "+e._s(e.label)+"\n    ")]):e._e()])],2)}),[],!1,null,"3a19692d",null);t.a=a.exports},fcH4:function(e,t,o){"use strict";var n=o("A7aG");o.n(n).a},gOs2:function(e,t,o){"use strict";o.r(t);o("hi3g"),o("lmye"),o("fp7Y"),o("SUr3"),o("3dw1");var n=o("f3R3"),i=o("fu9z"),c=o.n(i),s=o("vBp9"),a=o("Pyhl"),r=document.getElementById("data-translation")&&JSON.parse(document.getElementById("data-translation").innerHTML)||null,u=document.getElementById("mall-levin-coupon-error-translation")&&JSON.parse(document.getElementById("mall-levin-coupon-error-translation").innerHTML),l={components:{checkbox:n.a,offer:function(e){return o.e("product2077/offer").then(function(){return e(o("HgKx").default)}.bind(null,o)).catch(o.oe)},"offer-dialog":function(e){return o.e("product2077/offerDialog").then(function(){return e(o("SJZN").default)}.bind(null,o)).catch(o.oe)}},props:{marketList:{type:Array,default:function(){return[]}},offerList:{type:Array,default:function(){return[]}},selectedProduct:{type:Object,default:function(){}},couponList:{type:Array,default:function(){return[]}},spuCode:{type:String,default:""},skuCode:{type:String,default:""},isSupportTradeIn:{type:Boolean,default:!0},tradeInChoosen:{type:Object,default:function(){}},flashSale:{type:Object,default:function(){return{}}},productBankInfo:{type:Object,default:function(){return{}}},selectPreSale:{type:Object,default:function(){}},skuList:{type:Array,default:function(){return[]}}},data:function(){return{coupon:0,redCoinFlag:!1,freeShippingFlag:!1,exchangeFlag:!1,usedFlag:!1,canClaimCoupon:!0,isShippingFree:0,topPrice:0,topProductBonus:0,topSkuBonus:0,totalSavingPrice:0,finalPrice:0,userCanDeductPrice:0,redCoinsBoolean:!1,currentCouponDiscount:"",couponDiscountWithoutSymbol:0,couponStatus:"",activityCode:"",allCouponUsed:!1,haveCouponPromo:!1,pinCodeInfo:{isPincodeCheck:!1,isPincodeTips:"",pincode:""},claimCouponRet:!0,skuCouponList:[],trueOffer:!1,tradeinSkuObj:{},trueOfferList:[]}},computed:{showWholeDiscount:function(){var e=this.haveCouponPromo,t=this.hasRedCoins,o=this.totalSavingPrice;return e||t||this.trueOffer||o>0},isUserSignIn:function(){return!!c.a.methods.isSignIn()},hasRedCoins:function(){var e,t;return Number(null===(e=this.selectedProduct)||void 0===e?void 0:null===(t=e.redCoinsAmount)||void 0===t?void 0:t.deductAmount)>0},redCoinsPrice:function(){var e,t;return null===(e=this.selectedProduct)||void 0===e?void 0:null===(t=e.redCoinsAmount)||void 0===t?void 0:t.deductAmount},maxRedCoins:function(){var e,t;return null===(e=this.selectedProduct)||void 0===e?void 0:null===(t=e.redCoinsAmount)||void 0===t?void 0:t.deductAmountText},couponText:function(){return this.$t("product.checkBoxCoupon",{price:this.currentCouponDiscount})},freeShipping:function(){return this.$t("product.freeShipping",{price:this.currentCouponDiscount})},usedCoupon:function(){return this.$t("product.checkBoxUsed",{price:this.currentCouponDiscount})},redCoinsNotLoginText:function(){return this.$t("product.checkBoxRedCoinNotLogin",{price:this.formatCurrency(this.redCoins)})},redCoinsLoginText:function(){return this.$t("product.checkBoxUsersRedCoin",{price:this.formatCurrency(this.redCoins)})},noRedCoinsText:function(){return this.$t("product.checkBoxNoRedCoin",{price:this.formatCurrency(0)})},tradeInPrice:function(){var e,t;return this.tradeInChoosen?Number(null===(e=this.tradeInChoosen.quote)||void 0===e?void 0:e.quoteAmt)+Number(null===(t=this.tradeInChoosen.quote)||void 0===t?void 0:t.evaluatePromotionAmt):this.totalSavingPrice},tradeInText:function(){return this.tradeInChoosen?this.$t("product.checkBoxExchangeNoBonus",{price:this.formatCurrency(this.tradeInPrice)}):this.tradeInPrice>0?this.$t("product.checkBoxExchange",{price:this.formatCurrency(this.tradeInPrice)}):this.$t("product.checkBoxZeroExchange")},allCouponText:function(){return c.a.methods.isSignIn()?Number(this.isShippingFree)?this.allCouponUsed?this.$t("product.checkBoxUsed",{price:this.currentCouponDiscount}):this.$t("product.freeShipping",{price:this.currentCouponDiscount}):this.allCouponUsed?this.$t("product.noCheckBoxUsed",{price:this.currentCouponDiscount}):this.$t("product.noFreeShipping",{price:this.currentCouponDiscount}):Number(this.isShippingFree)?this.$t("product.checkBoxCoupon",{price:this.currentCouponDiscount}):this.$t("product.noCheckBoxCoupon",{price:this.currentCouponDiscount})},redCoins:function(){var e,t,o=0;c.a.methods.isSignIn()&&this.hasRedCoins?o=this.finalPrice:o=null===(e=this.selectedProduct)||void 0===e?void 0:null===(t=e.redCoinsAmount)||void 0===t?void 0:t.deductAmount;return o},price:function(){var e=0;return this.exchangeFlag&&(e+=Number(this.tradeInPrice)),this.redCoinFlag&&(e+=Number(this.redCoins)),this.freeShippingFlag&&(e+=Number(this.couponDiscountWithoutSymbol)),Number(e)}},watch:{skuCode:function(){this.getSkuCoupon(),this.findOfferList(),this.compareRedCoinsPriceWithDeductAmount(this.userCanDeductPrice),this.exchangeFlag=!1,this.tradeInChoosen?this.exchangeFlag=!0:this.exchangeFlag=!1,this.calTradeinPrice(),this.redCoinFlag=!1,this.freeShippingFlag=!1,this.claimCouponRet=!0,this.canClaimCoupon=!0,c.a.bus.$emit("give_to_seeOffer",this.showWholeDiscount)},tradeInChoosen:{handler:function(e){this.exchangeFlag=!!e},immediate:!0}},updated:function(){this.tradeInChoosen?this.exchangeFlag=!0:this.exchangeFlag=!1},mounted:function(){this.getUserMaxRedCoins(),this.getSkuCoupon(),this.getTradeinPriceBySkulist(),this.findOfferList(),c.a.bus.$emit("give_to_seeOffer",this.showWholeDiscount)},methods:{formatCurrency:c.a.misc.formatCurrency,findOfferList:function(){var e=this;this.trueOfferList=[],this.offerList.forEach((function(t){null!=t.skuCodes&&t.skuCodes.indexOf(e.skuCode)>-1&&e.trueOfferList.push(t),null==t.skuCodes&&e.trueOfferList.push(t)})),this.trueOfferList.length>0?this.trueOffer=!0:this.trueOffer=!1},getTradeinPriceBySkulist:function(){var e=this;if(this.isSupportTradeIn){var t=[];this.skuList.map((function(e){return t.push(e.skuCode)}));var o={method:"mall.tradein.price.fetch",biz_content:{pincode:this.pinCodeInfo.pincode,storeViewCode:c.a.site.store,skuCodes:t,deviceString:""}};Object(s.mallRequestAPI)(o).then((function(t){1==t.ret&&t.data.tradeInAmountsBonus?(e.tradeinSkuObj=t.data.tradeInAmountsBonus,e.calTradeinPrice()):e.totalSavingPrice=0})).catch((function(){c.a.bus.$emit("show-err-msg",r.networkErrMsg)}))}},calTradeinPrice:function(){var e,t=0;if(null!==(e=Object.keys(this.tradeinSkuObj))&&void 0!==e&&e.length){var o=this.tradeinSkuObj[this.skuCode],n=o.topSkuBonus,i=o.skuBonus,c=o.topProductBonus,s=o.productBonus,a=c>0?c:s>0?s:0;t=Number(n>0?n:i>0?i:0)+Number(a)}this.totalSavingPrice=t},clickExchangeShowPopup:function(){this.exchangeFlag&&!this.tradeInChoosen&&(c.a.bus.$emit("click-exchenge-show-popup",!0),this.exchangeFlag=!1)},notLoginShowCoupon:function(){this.getSignInUrl()},loginShowCoupon:function(){this.claimVoucher(this.activityCode,this.freeShippingFlag)},notLoginShowMaxDeductPrice:function(e){this.clickExchangeShowPopup(),this.TrackExchangeCheckbox(),this.exchangeFlag=e},notLoginShowZeroDeductPrice:function(e){this.clickExchangeShowPopup(),this.TrackExchangeCheckbox(),this.exchangeFlag=e},notLoginShowMaxTradeInPrice:function(e){this.clickExchangeShowPopup(),this.TrackExchangeCheckbox(),this.exchangeFlag=e},loginShowMaxDeductPrice:function(e){this.clickExchangeShowPopup(),this.TrackExchangeCheckbox(),this.exchangeFlag=e},loginShowZeroDeductPrice:function(e){this.clickExchangeShowPopup(),this.TrackExchangeCheckbox(),this.exchangeFlag=e},loginShowMaxTradeInPrice:function(e){this.clickExchangeShowPopup(),this.TrackExchangeCheckbox(),this.exchangeFlag=e},notLoginShowMaxCreditsPrice:function(){this.getSignInUrl()},getSignInUrl:function(){return c.a.methods.goToSignIn({returnUrl:window.location.href}),!1},TrackExchangeCheckbox:function(){Object(a.h)(this.spuCode)},getUserMaxRedCoins:function(){var e=this,t={biz_content:{productCodes:[this.spuCode],storeViewCode:c.a.site.store},method:"mall.product.user.point.fetch"};Object(s.mallRequestAPI)(t).then((function(t){1===Number(t.ret)&&(null==t.data?e.redCoinsBoolean=!1:(e.redCoinsBoolean=!0,e.userCanDeductPrice=t.data.point/t.data.proportion,e.compareRedCoinsPriceWithDeductAmount(e.userCanDeductPrice)))}))},compareRedCoinsPriceWithDeductAmount:function(e){this.finalPrice=this.redCoinsPrice>e?e:this.redCoinsPrice},getSkuCoupon:function(){this.clearCouponStatus();var e=this;this.couponList.map((function(t){t.skuCode===e.skuCode&&(e.couponDiscountWithoutSymbol=t.discount,e.currentCouponDiscount=t.currencySymbol+t.discount,e.couponStatus=t.activityStatus,e.activityCode=t.activityCode,e.allCouponUsed=t.isAllCouponUsed,e.isShippingFree=t.isShippingFree,e.haveCouponPromo=t.promoId)}))},claimVoucher:function(e,t){var o=this;if(t){var n={};n.biz_content={promotionId:e,storeViewCode:c.a.site.store},n.method="mallapp.coupon.receive",Object(s.receiveCouponsInfo)(n).then((function(e){if(1===Number(e.ret))o.$parent.initCouponInfo();else if(u&&u[e.errCode])if(e.errMsg=u[e.errCode],"1004006005"===e.errCode){var t;e.errMsg="".concat(u[e.errCode].t1," ").concat(null===(t=e.data)||void 0===t?void 0:t.userTotalReceiveLimit," ").concat(u[e.errCode].t2),c.a.bus.$emit("show-err-msg",e.errMsg)}else{if("1004006002"!==e.errCode)return;e.errMsg="This offer has expired.",c.a.bus.$emit("show-err-msg",e.errMsg)}o.claimCouponRet=!1,o.canClaimCoupon=!1})).catch((function(){window.AJAX_OPTIONS&&c.a.bus.$emit("show-err-msg",window.AJAX_OPTIONS.tips)}))}},openOffer:function(e){this.$refs.offerDialog.showDialog(e)},clearCouponStatus:function(){this.couponDiscountWithoutSymbol=0,this.currentCouponDiscount="",this.couponStatus="",this.activityCode="",this.allCouponUsed=!1,this.isShippingFree=0,this.haveCouponPromo=!1}}},h=(o("DvI6"),o("psIG")),d=Object(h.a)(l,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"product-station__discount"},[e.showWholeDiscount?o("div",{staticClass:"discount-container",attrs:{id:"seeOffering"}},[!(e.haveCouponPromo||e.hasRedCoins||0!=e.totalSavingPrice||e.trueOffer)||e.flashSale&&e.flashSale.canBuy?e._e():o("div",{staticClass:"discount-top flex"},[o("div",{staticClass:"discount-top__title font-subheading-md"},[e._v("\n        "+e._s(e.$t("product.discountTitle"))+"\n      ")]),e._v(" "),e.price>0&&(e.haveCouponPromo||e.hasRedCoins||e.totalSavingPrice>0)?o("div",{staticClass:"discount-top__desc font-body-md"},[e._v("\n        "+e._s(e.$t("product.discountDesc"))),o("span",{staticClass:"saving-price"},[e._v(e._s(e.formatCurrency(e.price)))])]):e._e(),e._v(" "),e.price<=0&&(e.haveCouponPromo||e.hasRedCoins||e.totalSavingPrice>0)?o("div",{staticClass:"discount-top__desc font-body-md"},[e._v("\n        "+e._s(e.$t("product.discountDescZero"))+"\n      ")]):e._e(),e._v(" "),e.price>0&&(e.haveCouponPromo||e.hasRedCoins||e.totalSavingPrice>0)?o("div",{staticClass:"discount-top__desc font-body-md checkbox-used"},[e._v("\n        "+e._s(e.$t("product.finalPriceAtCheckout"))+"\n      ")]):e._e()]),e._v(" "),!(e.haveCouponPromo||e.isSupportTradeIn||e.hasRedCoins)||!e.haveCouponPromo&&0==e.totalSavingPrice&&!e.hasRedCoins||e.flashSale&&e.flashSale.canBuy?e._e():o("div",{staticClass:"discount-checkbox"},[e.isUserSignIn?e._e():o("div",{staticClass:"discount-checkboxLogin"},[!e.haveCouponPromo||e.allCouponUsed||e.selectPreSale&&(20==e.selectPreSale.step||30==e.selectPreSale.step)||4==e.couponStatus||5==e.couponStatus?e._e():o("div",[o("checkbox",{staticClass:"checkbox-item disable",attrs:{label:e.allCouponText,disabled:!0},on:{change:e.notLoginShowCoupon},model:{value:e.freeShippingFlag,callback:function(t){e.freeShippingFlag=t},expression:"freeShippingFlag"}}),e._v(" "),o("a",{staticClass:"discount-checkbox__signin",on:{click:function(t){return e.getSignInUrl()}}},[e._v(e._s(e.$t("product.signIn")))])],1),e._v(" "),e.isSupportTradeIn&&e.totalSavingPrice>0&&!e.tradeInChoosen?o("div",[o("checkbox",{staticClass:"checkbox-item",attrs:{label:e.tradeInText},on:{change:e.notLoginShowMaxDeductPrice},model:{value:e.exchangeFlag,callback:function(t){e.exchangeFlag=t},expression:"exchangeFlag"}})],1):e._e(),e._v(" "),e.isSupportTradeIn&&0==e.totalSavingPrice&&!e.tradeInChoosen?o("div",[o("checkbox",{staticClass:"checkbox-item",attrs:{label:e.tradeInText},on:{change:e.notLoginShowZeroDeductPrice},model:{value:e.exchangeFlag,callback:function(t){e.exchangeFlag=t},expression:"exchangeFlag"}})],1):e._e(),e._v(" "),e.isSupportTradeIn&&e.tradeInChoosen?o("div",[o("checkbox",{staticClass:"checkbox-item",attrs:{label:e.tradeInText},on:{change:e.notLoginShowMaxTradeInPrice},model:{value:e.exchangeFlag,callback:function(t){e.exchangeFlag=t},expression:"exchangeFlag"}})],1):e._e(),e._v(" "),e.hasRedCoins?o("div",[o("checkbox",{staticClass:"checkbox-item",attrs:{label:e.redCoinsNotLoginText,disabled:!0},on:{change:e.notLoginShowMaxCreditsPrice},model:{value:e.redCoinFlag,callback:function(t){e.redCoinFlag=t},expression:"redCoinFlag"}}),e._v(" "),o("a",{staticClass:"discount-checkbox__signin",on:{click:function(t){return e.getSignInUrl()}}},[e._v(e._s(e.$t("product.signIn")))])],1):e._e()]),e._v(" "),e.isUserSignIn?o("div",{staticClass:"discount-checkboxLogin"},[4!=e.couponStatus&&5!=e.couponStatus&&e.haveCouponPromo&&(!e.selectPreSale||20!=e.selectPreSale.step&&30!=e.selectPreSale.step)?o("div",[!e.claimCouponRet||e.allCouponUsed||2!=e.couponStatus&&3!=e.couponStatus||!e.canClaimCoupon?e._e():o("div",[o("checkbox",{staticClass:"checkbox-item",attrs:{label:e.allCouponText},on:{change:e.loginShowCoupon},model:{value:e.freeShippingFlag,callback:function(t){e.freeShippingFlag=t},expression:"freeShippingFlag"}})],1),e._v(" "),e.claimCouponRet||e.allCouponUsed||e.canClaimCoupon?e._e():o("div",[o("checkbox",{staticClass:"checkbox-item",attrs:{label:e.allCouponText},model:{value:e.freeShippingFlag,callback:function(t){e.freeShippingFlag=t},expression:"freeShippingFlag"}})],1),e._v(" "),e.allCouponUsed?o("div",[o("checkbox",{staticClass:"checkbox-item checkbox-used",attrs:{label:e.allCouponText,disabled:!0},model:{value:e.usedFlag,callback:function(t){e.usedFlag=t},expression:"usedFlag"}})],1):e._e()]):e._e(),e._v(" "),e.isSupportTradeIn?[e.totalSavingPrice>0&&!e.tradeInChoosen?o("div",[o("checkbox",{staticClass:"checkbox-item",attrs:{label:e.tradeInText},on:{change:e.loginShowMaxDeductPrice},model:{value:e.exchangeFlag,callback:function(t){e.exchangeFlag=t},expression:"exchangeFlag"}})],1):e._e(),e._v(" "),0!=e.totalSavingPrice||e.tradeInChoosen?e._e():o("div",[o("checkbox",{staticClass:"checkbox-item",attrs:{label:e.tradeInText},on:{change:e.loginShowZeroDeductPrice},model:{value:e.exchangeFlag,callback:function(t){e.exchangeFlag=t},expression:"exchangeFlag"}})],1),e._v(" "),e.tradeInChoosen?o("div",[o("checkbox",{staticClass:"checkbox-item",attrs:{label:e.tradeInText},on:{change:e.loginShowMaxTradeInPrice},model:{value:e.exchangeFlag,callback:function(t){e.exchangeFlag=t},expression:"exchangeFlag"}})],1):e._e()]:e._e(),e._v(" "),e.hasRedCoins?[e.userCanDeductPrice>0?o("div",[o("checkbox",{staticClass:"checkbox-item",attrs:{label:e.redCoinsLoginText},model:{value:e.redCoinFlag,callback:function(t){e.redCoinFlag=t},expression:"redCoinFlag"}})],1):o("div",[o("checkbox",{staticClass:"checkbox-item checkbox-used",attrs:{label:e.noRedCoinsText,disabled:!0},model:{value:e.redCoinFlag,callback:function(t){e.redCoinFlag=t},expression:"redCoinFlag"}})],1)]:e._e()],2):e._e()]),e._v(" "),o("offer",{attrs:{"offer-list":e.offerList,"spu-code":e.spuCode,"sku-code":e.skuCode,"product-bank-info":e.productBankInfo,"sku-list":e.skuList},on:{"pop-offer":e.openOffer}})],1):e._e(),e._v(" "),o("offer-dialog",{ref:"offerDialog",attrs:{"product-bank-info":e.productBankInfo}})],1)}),[],!1,null,"fb8a1d4c",null);t.default=d.exports},mhnD:function(e,t,o){}}]);